<div class="w-full h-full flex-col space-y-7 overflow-hidden p-8">
  <div class="flex justify-between flex-row-reverse">
    <div>
      <p-button
        class="back"
        icon="pi pi-angle-left"
        [rounded]="true"
        [text]="true"
        [raised]="true"
        (onClick)="goBack()"
      ></p-button>
    </div>
    <div>
      <h1 class="text-2xl font-bold text-right text-gray-800 mb-6">إضافة يتيم</h1>
    </div>
  </div>

  <div class="flex">
    <form [formGroup]="orphanForm" class="flex justify-between w-full" (ngSubmit)="create()">
      <!-- Left Section: Inputs -->
      <div class="w-[70%] example-form space-y-5">
        <!-- Full Name & Guardian Name -->
        <div class="flex gap-3">
          <mat-form-field class="w-1/2">
            <mat-label>الاسم الكامل</mat-label>
            <input matInput formControlName="full_name"/>
            <mat-error *ngIf="orphanForm.get('full_name')?.hasError('required')">
              الاسم الكامل مطلوب
            </mat-error>
            <mat-error *ngIf="orphanForm.get('full_name')?.hasError('minlength')">
              الاسم يجب أن يكون على الأقل 3 أحرف
            </mat-error>
          </mat-form-field>

          <mat-form-field class="w-1/2">
            <mat-label>الكافل</mat-label>
            <mat-select formControlName="guardian_id">
              @for (guard of listGuardians; track guard.id) {
                <mat-option class="flex flex-row items-center" [value]="guard.id">
                  <p-avatar image="{{guard.pic_guardian}}" styleClass="mr-2 cursor-pointer"
                            size="normal"
                            shape="circle">
                  </p-avatar>
                  {{ guard.name }}
                </mat-option>
              }
            </mat-select>
            <mat-error *ngIf="orphanForm.get('guardian_id')?.hasError('required')">
              يجب اختيار كافل
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Birth Date & Mother's Name -->
        <div class="flex gap-3">
          <mat-form-field class="w-1/2">
            <mat-label>تاريخ الميلاد</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="birth_date">
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-error *ngIf="orphanForm.get('birth_date')?.hasError('required')">
              تاريخ الميلاد مطلوب
            </mat-error>
          </mat-form-field>

          <mat-form-field class="w-1/2">
            <mat-label>اسم الأم</mat-label>
            <input matInput formControlName="mother_name"/>
            <mat-error *ngIf="orphanForm.get('mother_name')?.hasError('required')">
              اسم الأم مطلوب
            </mat-error>
            <mat-error *ngIf="orphanForm.get('mother_name')?.hasError('minlength')">
              الاسم يجب أن يكون على الأقل 3 أحرف
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Slide Toggle -->
        <div>
          <mat-slide-toggle
            (change)="withoutPicture($event.checked)"
            [disabled]="hasPicture"
          >
            بدون صورة
          </mat-slide-toggle>
        </div>
        <div>
          <p-button
            type="submit"
            role="button"
            severity="contrast"
            [loading]="loading"
            [disabled]="loading || orphanForm.invalid"
          >
            <ng-container *ngIf="!loading">انشاء يتيم</ng-container>
          </p-button>
        </div>
      </div>

      <!-- Right Section: Image Upload -->
      <div class="w-[30%] flex flex-col items-center gap-5">
        <!-- Preview -->
        @if (objectURL) {
          <p-image
            class="rounded-sm"
            [src]="objectURL"
            alt="Preview"
            width="150"
            height="150"
          ></p-image>
        } @else {
          <div class="w-32 h-32 bg-gray-200 rounded flex items-center justify-center">
            <span class="text-gray-500">لا توجد صورة</span>
          </div>
        }

        <!-- Upload Button -->
        <label
          class="flex bg-gray-800 hover:bg-gray-700 text-white text-base font-medium px-4 py-2.5 rounded cursor-pointer">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 mr-2 fill-white" viewBox="0 0 32 32">
            <path
              d="M23.75 11.044a7.99 7.99 0 0 0-15.5-.009A8 8 0 0 0 9 27h3a1 1 0 0 0 0-2H9a6 6 0 0 1-.035-12 1.038 1.038 0 0 0 1.1-.854 5.991 5.991 0 0 1 11.862 0A1.08 1.08 0 0 0 23 13a6 6 0 0 1 0 12h-3a1 1 0 0 0 0 2h3a8 8 0 0 0 .75-15.956z"
            />
            <path
              d="M20.293 19.707a1 1 0 0 0 1.414-1.414l-5-5a1 1 0 0 0-1.414 0l-5 5a1 1 0 0 0 1.414 1.414L15 16.414V29a1 1 0 0 0 2 0V16.414z"
            />
          </svg>
          تحميل الصورة
          <input
            type="file"
            id="uploadFile1"
            class="hidden"
            accept="image/*"
            (change)="onFileChange($event)"
          />
        </label>

        <!-- Validation Message -->
        @if (!withoutPic && !hasPicture && orphanForm.get('pic_orphan')?.touched) {
          <div class="text-red-600 text-sm">
            تحميل الصورة مطلوب
          </div>
        }
      </div>
    </form>
  </div>
</div>
